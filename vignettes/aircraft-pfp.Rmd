---
title: "aircraft-pfp"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{aircraft-pfp}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(rtorf)
library(data.table)
```


```{r read1, eval = T}

cate = c("aircraft-pfp",
         "aircraft-insitu",
         "aircraft-flask",
         "surface-insitu",
         "surface-flask", 
         "surface-pfp",   
         "tower-insitu",  
         "aircore",       
         "shipboard-insitu",
         "shipboard-flask") 

obs <- "Z:/torf/obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08/data/nc/"
index <- obs_summary(obs = obs, 
                     categories = cate)

```

Now we read the aircraft-pfp using the function `obs_read_nc`. To this date,
`solar_time` is not included for aircraft, so we `FALSE` that argument.

```{r}
df <- obs_read_nc(index = index,
                  categories = "aircraft-pfp",
                  solar_time = FALSE,
                  verbose = T)

format(object.size(df), unit = "Gb")
```

Now we check the data

```{r checkdf}
df
```


Now we can process the data. We first filter for observations
within our spatial domain:

## Checks and definitions

```{r spatial}
north <- 80
south <- 10
west <- -170
east <- -50
max_altitude <- 8000
yy <- 2020

```

We check altitude, intake_height, altitude_final and elevation.
altitude_final is a column from intake_height, added to match
column from obs_read text files.

```{r}
df[, c("altitude", "altitude_final", "intake_height", "elevation")]
```

The spatial range of data is
```{r range_year}
range(df$year)
```

We also check for dimensions of data

```{r dim_df}
dim(df)
```

## Filters

```{r, spatial_temporal_filter}
df <- df[year == yy]

df <- df[altitude_final < max_altitude &
           latitude < north &
           latitude > south &
           longitude < east &
           longitude > west]
dim(df)
```

## Adding time as POSIXct class

```{r add_time1}
df <- obs_addtime(df)
df[, "timeUTC"]
```


